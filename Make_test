# Compiler Specification
CC=g++
CFLAGS=-g3 -DSYSTIME

# Some Compiler Flags
OPTFLAGS=-Ofast -march=native -ffast-math -O3 -fopenmp

# Analysis Flags
ANALYSIS=-Rpass-analysis=loop-vectorize

CFLAGS+=$(OPTFLAGS) $(ANALYSIS)

# ===
all:
	$(CC) $(CFLAGS) -o Douglas-ADI adi_main.cpp

#.PHONY: iprofile
#iprofile: adi_main adi_main.dSYM
#	iprofiler -timeprofiler -o adi_main_perf ./adi_main
#	open adi_main_perf.dtps

# big: lshallow
	# ./lshallow tests.lua dam 400


# ===
# Example analyses

# .PHONY: maqao scan-build
#
# maqao: lshallow
# 	( module load maqao ; \
# 	  maqao cqa ./lshallow fct=compute_step uarch=HASWELL )
#
# scan-build:
# 	( module load llvm-analyzer ; \
# 	  scan-build -v --use-analyzer=/share/apps/llvm-3.7.0/bin/clang make )

# ===
# Generate output files

# ===
# Clean up

.PHONY: clean
clean:
	rm -f douglas_adi *.o
	rm -f *.optrpt
	rm -rf *.dSYM
	rm -rf adi_main_perf.dtps
